# 中间件

## Redis

***TODO***

### 数据类型

|数据类型|可存储的值|操作|应用场景|
|---|---|---|---|
|String|字符串、整数或浮点数|对整个字符串或字符串的其中一部分执行操作<br>对整数和浮点数执行自增或自减操作|简单的键值对缓存|
|List|列表|从两端压入或弹出元素<br>对单个或多个元素进行修剪，只保留一个范围内的元素|存储列表型数据结构|
|Set|无序集合|添加、获取、删除单个元素<br>检查一个元素是否存在于集合中<br>计算交集、并集、差集<br>从集合中随机获取元素|交集、并集、差集的操作|
|Hash|包含键值对的无序散列表|添加、获取、移除单个键值对<br>获取所有键值对<br>检查某个键是否存在|结构化的数据，如对象|
|ZSet|有序集合|添加、获取、删除元素<br>根据分值范围或成员来获取元素<br>计算一个键的排名|去重，排序|

### 应用场景

- 计数器：***TODO***
- 缓存：***TODO***
- 会话缓存：***TODO***
- 全页缓存：***TODO***
- 查找表：***TODO***
- 消息队列：***TODO***
- 分布式锁实现：***TODO***
- 其他操作：***TODO***

### 缓存

**缓存穿透**

分析：***TODO***

解决方案：***TODO***

**缓存雪崩**

分析：***TODO***

解决方案：***TODO***

**缓存击穿**

分析：***TODO***

解决方案：***TODO***

### 持久化

将内存的数据写入磁盘，防止服务宕机导致内存数据丢失。

机制：

1. RDB（默认）

    ***TODO***

2. AOF

    ***TODO***

优缺点：***TODO***

### 过期时间

设置过期时间的命令：`EXPIRE`。

***TODO***

#### 过期键的删除策略

由于缓存的key可以设置过期时间，过期策略讨论的是当缓存的key过期了如何处理的问题。

1. 定时过期 ***TODO***

2. 惰性过期 ***TODO***

3. 定期过期 ***TODO***

### 淘汰策略

***TODO***

### 线程模型

***TODO***

### 事务

***TODO***

### 集群

***TODO***

### 分区

***TODO***

## 消息队列

消息队列解决的核心问题是：异步、削峰、解耦。

缺点：

- 系统可靠性降低，解耦后，多个系统通过消息中间件交互，消息中间件宕机会导致整个系统宕机；
- 系统开发复杂度提升，需要考虑消息的处理，包括消息幂等性（重复消息问题），消息保序性（一条订单多条消息问题），以及消息中间件本身的持久化和稳定性可靠性；
- 消息一致性问题，若一个功能发给多个系统，要所有系统都执行成功才算成功时，需要确保一个功能多个消息的完整一致性。

各种消息队列的比较

|特性|ActiveMQ|RabbitMQ|RocketMQ|Kafka|
|---|---|---|---|---|
|单机吞吐量|万/秒|万/秒|10万/秒|10万/秒|
|topic对吞吐量的影响|无|无|topic达到几百/几千个级别，吞吐量会有小幅下降|topic可达到几十/几百个级别，吞吐量会有大幅下降，不适合大批量topic场景，除非加机器|
|时效性|毫秒|微秒|毫秒|毫秒|
|可用性|高，主从架构|高，主从架构|非常高，分布式|非常高，分布式，数据多副本，不会丢数据，不会不可用|
|可靠性|有较低概率丢失数据||经配置优化可达到0丢失|经配置优化可达到0丢失|
|功能特性|功能齐全，但已不怎么维护|Erlang开发，并发强，性能极好，延迟低|功能较为齐全，扩展好|功能简单，主要用于大数据实时计算和日志采集，事实标准|

### ActiveMQ

- 优点：技术成熟，功能齐全，历史悠久，有大量公司使用
- 缺点：偶尔会有较低概率丢失数据，而且社区已经不怎么维护5.15.X版本
- 使用场景：主要用于系统解耦和异步处理，不适用于大数据量吞吐情况

### RocketMQ

- 优点：支持百千级大规模topic，吞吐量高（十万级，日处理上百亿），接口易用，分布式易扩展
- 缺点：不兼容JMS规范，与阿里（社区）存在绑定
- 使用场景：高吞吐量

### Kafka

分布式消息队列，***TODO***

- 优点：超高吞吐量，超高可用性和可靠性，分布式易扩展
- 缺点：topic支持少，MQ功能简单，消息可能会重复消费影响数据精确度
- 使用场景：超高吞吐量场景而数据精确度没那么高，天然适合大数据实时计算和日志采集场景

### RabbitMQ

- 优点：吞吐量高，功能齐全，管理界面易用，社区活跃，性能极好
- 缺点：吞吐量只是万级，由于是Erlang开发故难以二次开发和掌控，集群动态扩展非常麻烦
- 使用场景：吞吐量不高而要求低延迟，且不会频繁调整和扩展的场景

#### 模式

- 单机模式：***TODO***
- 普通集群模式：***TODO***
- 镜像集群模式：***TODO***

### RocketMQ

***TODO***

## ElasticSearch

***TODO***